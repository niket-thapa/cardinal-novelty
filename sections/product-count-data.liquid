{%- comment -%}
  Product Count Data Section
  Used for fast product counting by paginating with 200 products per page
  Filters products the same way as main collection: available and not hidden
{%- endcomment -%}

{%- paginate collection.products by 200 -%}
  {%- liquid
    # Count available and not hidden products on current page (same logic as main collection)
    assign available_count_on_page = 0
    
    for product in collection.products
      assign should_show_product = true
      
      # Check if product should be hidden from listings
      if product.metafields.custom.hide_from_listings.value == true or product.available == false
        assign should_show_product = false
      endif
      
      # Check if all variants are hidden
      if should_show_product and product.variants_count > 0
        assign all_variants_hidden = true
        for variant in product.variants
          if variant.metafields.custom.hide_product != true
            assign all_variants_hidden = false
            break
          endif
        endfor
        if all_variants_hidden
          assign should_show_product = false
        endif
      endif
      
      if should_show_product
        assign available_count_on_page = available_count_on_page | plus: 1
      endif
    endfor
  -%}
  <div 
    data-section-id="{{ section.id }}"
    data-section-type="product-count-data"
    data-product-count="{{ available_count_on_page }}"
    data-total-pages="{{ paginate.pages }}"
    data-current-page="{{ paginate.current_page }}"
    style="display: none;"
  ></div>
{%- endpaginate -%}

{% schema %}
{
  "name": "Product Count Data",
  "settings": [],
  "presets": [
    {
      "name": "Product Count Data"
    }
  ]
}
{% endschema %}

